{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, withKeys as _withKeys, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"chat-box\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_card_title = _resolveComponent(\"v-card-title\");\n  const _component_v_text_field = _resolveComponent(\"v-text-field\");\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  const _component_v_card_text = _resolveComponent(\"v-card-text\");\n  const _component_v_card = _resolveComponent(\"v-card\");\n  const _component_v_col = _resolveComponent(\"v-col\");\n  const _component_v_row = _resolveComponent(\"v-row\");\n  const _component_v_container = _resolveComponent(\"v-container\");\n  return _openBlock(), _createBlock(_component_v_container, null, {\n    default: _withCtx(() => [_createVNode(_component_v_row, {\n      justify: \"center\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_v_col, {\n        cols: \"12\",\n        md: \"8\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_v_card, null, {\n          default: _withCtx(() => [_createVNode(_component_v_card_title, {\n            class: \"text-center text-h5\"\n          }, {\n            default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\" 채팅 \")])),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_v_card_text, null, {\n            default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.messages, (msg, index) => {\n              return _openBlock(), _createElementBlock(\"div\", {\n                key: index,\n                class: _normalizeClass(['chat-message', msg.senderEmail === this.senderEmail ? 'sent' : 'received'])\n              }, [_createElementVNode(\"strong\", null, _toDisplayString(msg.senderEmail) + \": \", 1 /* TEXT */), _createTextVNode(\" \" + _toDisplayString(msg.message), 1 /* TEXT */)], 2 /* CLASS */);\n            }), 128 /* KEYED_FRAGMENT */))]), _createVNode(_component_v_text_field, {\n              modelValue: $data.newMessage,\n              \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.newMessage = $event),\n              label: \"메시지 입력\",\n              onKeyup: _withKeys($options.sendMessage, [\"enter\"])\n            }, null, 8 /* PROPS */, [\"modelValue\", \"onKeyup\"]), _createVNode(_component_v_btn, {\n              color: \"primary\",\n              block: \"\",\n              onClick: $options.sendMessage\n            }, {\n              default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\"전송\")])),\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"onClick\"])]),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","_createBlock","_component_v_container","default","_withCtx","_createVNode","_component_v_row","justify","_component_v_col","cols","md","_component_v_card","_component_v_card_title","_cache","_createTextVNode","_","_component_v_card_text","_createElementVNode","_hoisted_1","_createElementBlock","_Fragment","_renderList","$data","messages","msg","index","key","_normalizeClass","senderEmail","_toDisplayString","message","_component_v_text_field","modelValue","newMessage","$event","label","onKeyup","_withKeys","$options","sendMessage","_component_v_btn","color","block","onClick"],"sources":["/Users/dengo/Desktop/java/spring_websocket/chat-front/src/views/StompChatPage.vue"],"sourcesContent":["<template>\n  <v-container>\n    <v-row justify=\"center\">\n      <v-col cols=\"12\" md=\"8\">\n        <v-card>\n          <v-card-title class=\"text-center text-h5\">\n            채팅\n          </v-card-title>\n          <v-card-text>\n            <div class=\"chat-box\">\n              <div\n              v-for=\"(msg, index) in messages\"\n              :key=\"index\"\n              :class=\"['chat-message', msg.senderEmail ===this.senderEmail ? 'sent':'received']\"\n              >\n                <strong>{{msg.senderEmail}}: </strong> {{msg.message}}\n              </div>\n            </div>\n            <v-text-field\n              v-model=\"newMessage\"\n              label=\"메시지 입력\"\n              @keyup.enter=\"sendMessage\"\n\n            />\n              <v-btn color=\"primary\" block @click=\"sendMessage\">전송</v-btn>\n          </v-card-text>\n\n        </v-card>\n      </v-col>\n\n    </v-row>\n\n  </v-container>\n</template>\n\n\n<script>\nimport SockJS from 'sockjs-client';\nimport Stomp from 'webstomp-client';\nimport axios from 'axios';\n\nexport default {\n  data(){\n    return{\n      messages: [],\n      newMessage: \"\",\n      stompClient: null,\n      token: \"\",\n      senderEmail: null,\n      roomId: null,\n    }\n  },\n  async created(){\n    this.senderEmail = localStorage.getItem(\"email\");\n    this.roomId = this.$route.params.roomId;\n    const response = await axios.get(`${process.env.VUE_APP_API_BASE_URL}/chat/history/${this.roomId}`)\n    this.messages = response.data;\n    this.connectWebSocket();\n  },\n  //사용자가 현재 라우트에서 다른 라우트로 이동하려고 할 때 호출되는 훅 함수.\n  beforeRouteLeave(to, from, next) {\n    this.disconnectWebSocket();\n    next();\n  },\n  //화면을 완전히 종료 했을 때\n  beforeUnmount() {\n    this.disconnectWebSocket();\n  },\n  methods:{\n    connectWebSocket(){\n      if(this.stompClient && this.stompClient.connected) return;\n      // sockjs는 websocket을 내장한 향상된 js라이브러리 http엔드포인트 사용.\n      const sockJs = new SockJS(`${process.env.VUE_APP_API_BASE_URL}/connect`)\n      this.stompClient = Stomp.over(sockJs);\n      this.token = localStorage.getItem(\"token\");\n      this.stompClient.connect({\n            Authorization: `Bearer ${this.token}`\n\n          },\n          ()=>{\n            this.stompClient.subscribe(`/topic/${this.roomId}`,(message)=>{\n              const parseMessage = JSON.parse(message.body)\n              this.messages.push(parseMessage);\n              this.scrollToBottom();\n            },{Authorization: `Bearer ${this.token}`})\n          }\n      )\n    },\n\n    sendMessage(){\n      if(this.newMessage.trim()===\"\")return;\n      const message = {\n        senderEmail: this.senderEmail,\n        message: this.newMessage\n      }\n      this.stompClient.send(`/publish/${this.roomId}`,JSON.stringify(message));\n      this.newMessage=\"\";\n    },\n    scrollToBottom(){\n      this.$nextTick(()=>{\n        const chatBox = this.$el.querySelector(\".chat-box\");\n        chatBox.scrollTop=chatBox.scrollHeight;\n      })\n    },\n    disconnectWebSocket(){\n      if (this.stompClient && this.stompClient.connected) {\n        this.stompClient.unsubscribe(`/topic/${this.roomId}`);\n        this.stompClient.disconnect();\n      }\n    }\n  },\n}\n\n</script>\n<style>\n.chat-box{\n  height: 300px;\n  overflow-y: auto;\n  border: 1px solid #ddd;\n  margin-bottom: 10px;\n\n}\n\n.chat-message{\n  margin-bottom:10px;\n\n}\n\n.sent{\n  text-align: right;\n}\n\n.received{\n  text-align: left;\n}\n</style>"],"mappings":";;EASiBA,KAAK,EAAC;AAAU;;;;;;;;;;uBAR/BC,YAAA,CA+BcC,sBAAA;IAhChBC,OAAA,EAAAC,QAAA,CAEI,MA4BQ,CA5BRC,YAAA,CA4BQC,gBAAA;MA5BDC,OAAO,EAAC;IAAQ;MAF3BJ,OAAA,EAAAC,QAAA,CAGM,MAyBQ,CAzBRC,YAAA,CAyBQG,gBAAA;QAzBDC,IAAI,EAAC,IAAI;QAACC,EAAE,EAAC;;QAH1BP,OAAA,EAAAC,QAAA,CAIQ,MAuBS,CAvBTC,YAAA,CAuBSM,iBAAA;UA3BjBR,OAAA,EAAAC,QAAA,CAKU,MAEe,CAFfC,YAAA,CAEeO,uBAAA;YAFDZ,KAAK,EAAC;UAAqB;YALnDG,OAAA,EAAAC,QAAA,CAKoD,MAE1CS,MAAA,QAAAA,MAAA,OAPVC,gBAAA,CAKoD,MAE1C,E;YAPVC,CAAA;cAQUV,YAAA,CAiBcW,sBAAA;YAzBxBb,OAAA,EAAAC,QAAA,CASY,MAQM,CARNa,mBAAA,CAQM,OARNC,UAQM,I,kBAPJC,mBAAA,CAMMC,SAAA,QAhBpBC,WAAA,CAWqCC,KAAA,CAAAC,QAAQ,EAX7C,CAWsBC,GAAG,EAAEC,KAAK;mCADlBN,mBAAA,CAMM;gBAJLO,GAAG,EAAED,KAAK;gBACVzB,KAAK,EAbpB2B,eAAA,kBAauCH,GAAG,CAACI,WAAW,UAASA,WAAW;kBAE1DX,mBAAA,CAAsC,gBAAAY,gBAAA,CAA5BL,GAAG,CAACI,WAAW,IAAE,IAAE,iBAf7Cd,gBAAA,CAesD,GAAC,GAAAe,gBAAA,CAAEL,GAAG,CAACM,OAAO,iB;8CAGxDzB,YAAA,CAKE0B,uBAAA;cAvBdC,UAAA,EAmBuBV,KAAA,CAAAW,UAAU;cAnBjC,uBAAApB,MAAA,QAAAA,MAAA,MAAAqB,MAAA,IAmBuBZ,KAAA,CAAAW,UAAU,GAAAC,MAAA;cACnBC,KAAK,EAAC,QAAQ;cACbC,OAAK,EArBpBC,SAAA,CAqB4BC,QAAA,CAAAC,WAAW;gEAGzBlC,YAAA,CAA4DmC,gBAAA;cAArDC,KAAK,EAAC,SAAS;cAACC,KAAK,EAAL,EAAK;cAAEC,OAAK,EAAEL,QAAA,CAAAC;;cAxBnDpC,OAAA,EAAAC,QAAA,CAwBgE,MAAES,MAAA,QAAAA,MAAA,OAxBlEC,gBAAA,CAwBgE,IAAE,E;cAxBlEC,CAAA;;YAAAA,CAAA;;UAAAA,CAAA;;QAAAA,CAAA;;MAAAA,CAAA;;IAAAA,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}